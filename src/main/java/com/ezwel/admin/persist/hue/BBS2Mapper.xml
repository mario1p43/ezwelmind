<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ezwel.admin.persist.hue.BBS2Mapper">


	<insert id="insertBbs" keyProperty="dataSeq" useGeneratedKeys="true" parameterType="com.ezwel.admin.service.hue.dto.BBSAdd2Dto">
		INSERT INTO MIND_BBS_DATA (
			 BBS_CD
			,SERVICE_TYPE
			<if test="isNotNull(clientCd)">
				,CLIENT_CD
			</if>
			,SUBJECT
			,CONTENT
			,REQ_CD1
			<if test="isNotNull(reqCd2)">
				,REQ_CD2
			</if>
			<if test="isNotNull(dispYn)">
				,DISP_YN
			</if>
			<if test="isNotNull(pageKey)">
				,PAGE_KEY
			</if>
			<if test="isNotNull(allClientYn)">
				,ALL_CLIENT_YN
			</if>
			,REG_ID
			,REG_NM
			,REG_DT
			<if test="isNotNull(regMobile)">
				,REG_MOBILE
			</if>
			<if test="isNotNull(regEmail)">
				,REG_EMAIL
			</if>
			,COLUMNIST_NM
			,COLUMNIST_DD
			,COLUMNIST_CAREER
			,COLUMNIST_MEMO
			,COLUMNIST_GRADE
			<if test="isNotNull(newsDd)">
				,NEWS_DD
			</if>
		) VALUES (
			 #{bbsCd}
			 <if test="isNotNull(serviceType)">
				,#{serviceType}
			</if>
			<if test="isNull(serviceType)">
				,'HOME'
			</if>
			<if test="isNotNull(clientCd)">
				,#{clientCd}
			</if>
			,#{subject}
			,#{content}
			,#{reqCd1}
			<if test="isNotNull(reqCd2)">
				,#{reqCd2}
			</if>
			<if test="isNotNull(dispYn)">
				,#{dispYn}
			</if>
			<if test="isNotNull(pageKey)">
				,#{pageKey}
			</if>
			<if test="isNotNull(allClientYn)">
				,#{allClientYn}
			</if>
			,#{regId}
			,#{regNm}
			,DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
			<if test="isNotNull(regMobile)">
				,#{regMobile}
			</if>
			<if test="isNotNull(regEmail)">
				,#{regEmail}
			</if>
			,#{columnistNm}
			,#{columnistDd}
			,#{columnistCareer}
			,#{columnistMemo}
			,#{columnistGrade}
			<if test="isNotNull(newsDd)">
				,#{newsDd}
			</if>
		)
	</insert>
<insert id="insertBbs2" keyProperty="dataSeq" useGeneratedKeys="true" parameterType="com.ezwel.admin.service.hue.dto.BBSAdd2Dto">
		INSERT INTO HUE_BBS_DATA (
			 BBS_CD
			,CENTER_SEQ
			,SUBJECT
			,CONTENT
			,REQ_CD1
			<if test="isNotNull(reqCd2)">
				,REQ_CD2
			</if>
			<if test="isNotNull(dispYn)">
				,DISP_YN
			</if>
			<if test="isNotNull(pageKey)">
				,PAGE_KEY
			</if>
			<if test="isNotNull(allClientYn)">
				,ALL_CLIENT_YN
			</if>
			,REG_ID
			,REG_NM
			,REG_DT
			<if test="isNotNull(regMobile)">
				,REG_MOBILE
			</if>
			<if test="isNotNull(regEmail)">
				,REG_EMAIL
			</if>
			,COLUMNIST_NM
			,COLUMNIST_DD
			,COLUMNIST_CAREER
			,COLUMNIST_MEMO
			,COLUMNIST_GRADE
			<if test="isNotNull(newsDd)">
				,NEWS_DD
			</if>
		) VALUES (
			 #{bbsCd}
			,'1'
			,#{subject}
			,#{content}
			,#{reqCd1}
			<if test="isNotNull(reqCd2)">
				,#{reqCd2}
			</if>
			<if test="isNotNull(dispYn)">
				,#{dispYn}
			</if>
			<if test="isNotNull(pageKey)">
				,#{pageKey}
			</if>
			<if test="isNotNull(allClientYn)">
				,#{allClientYn}
			</if>
			,#{regId}
			,#{regNm}
			,DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
			<if test="isNotNull(regMobile)">
				,#{regMobile}
			</if>
			<if test="isNotNull(regEmail)">
				,#{regEmail}
			</if>
			,#{columnistNm}
			,#{columnistDd}
			,#{columnistCareer}
			,#{columnistMemo}
			,#{columnistGrade}
			<if test="isNotNull(newsDd)">
				,#{newsDd}
			</if>
		)
	</insert>
	<update id="updateBbs" parameterType="com.ezwel.admin.service.hue.dto.BBSAdd2Dto">
		UPDATE MIND_BBS_DATA
		SET  SUBJECT = #{subject}
		    ,CONTENT = #{content}
			,COLUMNIST_NM = #{columnistNm}
			,COLUMNIST_DD = #{columnistDd}
			,COLUMNIST_CAREER = #{columnistCareer}
			,COLUMNIST_MEMO = #{columnistMemo}
			,COLUMNIST_GRADE = #{columnistGrade}
		    <if test="isNotNull(dispYn)">
				,DISP_YN = #{dispYn}
			</if>
			<if test="isNotNull(reqCd1)">
				,REQ_CD1 = #{reqCd1}
			</if>
			<if test="isNotNull(reqCd2)">
				,REQ_CD2 = #{reqCd2}
			</if>
			<if test="isNotNull(allClientYn)">
				,ALL_CLIENT_YN = #{allClientYn}
			</if>
			<if test="isNull(allClientYn)">
				,ALL_CLIENT_YN = 'N'
			</if>
			<if test="isNotNull(modiNm)">
				,MODI_NM = #{modiNm}
				,MODI_DT = DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
			</if>
			<if test="isNotNull(modiId)">
				,MODI_ID = #{modiId}
			</if>
			<if test="isNotNull(newsDd)">
				,NEWS_DD = #{newsDd}
			</if>
		WHERE DATA_SEQ = #{dataSeq}
	</update>
	<update id="updateBbs2" parameterType="com.ezwel.admin.service.hue.dto.BBSAdd2Dto">
		UPDATE HUE_BBS_DATA
		SET  SUBJECT = #{subject}
		    ,CONTENT = #{content}
			,COLUMNIST_NM = #{columnistNm}
			,COLUMNIST_DD = #{columnistDd}
			,COLUMNIST_CAREER = #{columnistCareer}
			,COLUMNIST_MEMO = #{columnistMemo}
			,COLUMNIST_GRADE = #{columnistGrade}
		    <if test="isNotNull(dispYn)">
				,DISP_YN = #{dispYn}
			</if>
			<if test="isNotNull(reqCd1)">
				,REQ_CD1 = #{reqCd1}
			</if>
			<if test="isNotNull(reqCd2)">
				,REQ_CD2 = #{reqCd2}
			</if>
			<if test="isNotNull(allClientYn)">
				,ALL_CLIENT_YN = #{allClientYn}
			</if>
			<if test="isNull(allClientYn)">
				,ALL_CLIENT_YN = 'N'
			</if>
			<if test="isNotNull(modiNm)">
				,MODI_NM = #{modiNm}
				,MODI_DT = DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
			</if>
			<if test="isNotNull(modiId)">
				,MODI_ID = #{modiId}
			</if>
			<if test="isNotNull(newsDd)">
				,NEWS_DD = #{newsDd}
			</if>
		WHERE DATA_SEQ = #{dataSeq}
	</update>	

	<delete id="deleteBbs" parameterType="com.ezwel.admin.service.hue.dto.BBSAdd2Dto">
		DELETE FROM MIND_BBS_DATA
		WHERE DATA_SEQ = #{dataSeq}
	</delete>


	<select id="getBbsList2" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
		<if test="pageCommonFlag == true">
			SELECT COUNT(*) pageCommonCount
			  FROM
			    (
		</if>
				SELECT  
				 CONTACT_NO AS contactNo
				,COUNSEL_NM AS counNm
				,MOBILE AS mobile
				,REG_DT AS regDt
				,DATE AS date
				,TIME AS time
				,C_DATE AS cdate
				,C_TIME AS ctime
				,C_STATUS AS cstatus
				,GENDER AS gender
				 from hue_counsel_contact
				 
				WHERE 1=1
				<if test="isNotNull(searchNm)">
					AND COUNSEL_NM LIKE CONCAT('%', #{searchNm},'%') 
				</if>
				<if test="isNotNull(searchMobile)">
					AND MOBILE  LIKE CONCAT('%', #{searchMobile},'%') 
				</if>
				<if test="isNotNull(genderArr)">
					AND GENDER = #{genderArr}
				</if>
				
				<if test="isNotNull(searchArr)">
					AND C_STATUS REGEXP #{searchArr}
				</if>
				<if test="isNotNull(startRDt)">
					AND REG_DT between  CONCAT(#{startRDt}, ' 00:00:00') and  CONCAT(#{endRDt}, ' 23:59:59') 
				</if>				
				<if test="isNotNull(startDt)">
					AND DATE between #{startDt} and #{endDt} 
				</if>				
				<if test="isNotNull(startCDt)">
					AND C_DATE between #{startCDt} and #{endCDt} 
				</if>												
				
				ORDER BY CONTACT_NO DESC
		<choose>
			<when test="pageCommonFlag == true">
				) A
			</when>
			<otherwise>
				LIMIT #{firstIndex} , #{pageSize}
			</otherwise>
		</choose>
	</select>
	
	<select id="getBbsList5" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
		<if test="pageCommonFlag == true">
			SELECT COUNT(*) pageCommonCount
			  FROM
			    (
		</if>
				SELECT  
				 CONTACT_NO AS contactNo
				,COUNSEL_NM AS counNm
				,MOBILE AS mobile
				,REG_DT AS regDt
				,DATE AS date
				,TIME AS time
				,C_DATE AS cdate
				,C_TIME AS ctime
				,C_STATUS AS cstatus
				,GENDER AS gender
				 from hue_counsel_contact
				 
				WHERE 1=1
				<if test="isNotNull(searchNm)">
					AND COUNSEL_NM LIKE CONCAT('%', #{searchNm},'%') 
				</if>
				<if test="isNotNull(searchMobile)">
					AND MOBILE  LIKE CONCAT('%', #{searchMobile},'%') 
				</if>
				<if test="isNotNull(genderArr)">
					AND GENDER = #{genderArr}
				</if>
				
				<if test="isNotNull(searchArr)">
					AND C_STATUS REGEXP #{searchArr}
				</if>
				<if test="isNotNull(startRDt)">
					AND REG_DT between  CONCAT(#{startRDt}, ' 00:00:00') and  CONCAT(#{endRDt}, ' 23:59:59') 
				</if>				
				<if test="isNotNull(startDt)">
					AND DATE between #{startDt} and #{endDt} 
				</if>				
				<if test="isNotNull(startCDt)">
					AND C_DATE between #{startCDt} and #{endCDt} 
				</if>												
				
				ORDER BY CONTACT_NO DESC
		<choose>
			<when test="pageCommonFlag == true">
				) A
			</when>			
		</choose>
	</select>
	
	<select id="getBbsList3" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
		<if test="pageCommonFlag == true">
			SELECT COUNT(*) pageCommonCount
			  FROM
			    (
		</if>
					select 
					A.INTAKE_CD as intakeCd 
					,B.COUNSEL_NO as counselNo
					,A.COUNSEL_NM as counselNm
					,A.MOBILE as mobile
					,B.DATE as date
					,B.TIME as time
					,B.CAUSE as cause
					,B.STATUS as status
					,B.USER_ID as userId
					,B.REG_DT as regDt
					,B.MODI_DT as modiDt
					,(SELECT USER_NM FROM mind_mgr WHERE USER_ID=B.USER_ID) AS userNm
					,B.MODI_ID as modiId
					, (CASE WHEN SUBSTRING(B.CAUSE,1,1) = '1' THEN '건강한 마음'
							WHEN SUBSTRING(B.CAUSE,1,1) = '2' THEN '성장하는 삶'
							WHEN SUBSTRING(B.CAUSE,1,1) = '3' THEN '행복한 가정'
							WHEN SUBSTRING(B.CAUSE,1,1) = '4' THEN '즐거운 직장'
							WHEN SUBSTRING(B.CAUSE,1,1) = '5' THEN '기타'
							END) AS strCause
					, (CASE 
							WHEN B.STATUS = '' THEN '상담예정'
							WHEN B.STATUS IS NULL THEN '상담예정'
							WHEN B.STATUS = '1' THEN '상담예정'
							WHEN B.STATUS = '2' THEN '상담진행'
							WHEN B.STATUS = '3' THEN '상담종결' END) AS strStatus

					,(SELECT USER_NM FROM mind_mgr WHERE USER_ID=B.MODI_ID) AS modiNm
 					from hue_counsel_intake AS A 
 					left join  hue_counsel_mgr AS B on A.INTAKE_CD=B.INTAKE_CD
				 
				WHERE 1=1
				
				<if test="isNotNull(checkUserId)">
					AND( B.USER_ID=  #{checkUserId} or B.REG_ID=  #{checkUserId} )
				</if>
				<if test="isNotNull(centerNm)">
					AND B.CAUSE LIKE CONCAT('%', #{centerNm},'%') 
				</if>
				<if test="isNotNull(searchNm)">
					AND A.COUNSEL_NM LIKE CONCAT('%', #{searchNm},'%') 
				</if>
				<if test="isNotNull(searchMobile)">
					AND A.MOBILE  LIKE CONCAT('%', #{searchMobile},'%') 
				</if>
				<if test="isNotNull(statusArr)">
					AND B.STATUS =  #{statusArr} 
				</if>
				<if test="isNotNull(userNm)">
					AND B.USER_ID = #{userNm} 
				</if>
				
				<if test="isNotNull(startRDt)">
					AND A.DATE between #{startRDt} and #{endRDt}					
				</if>				
				<if test="isNotNull(startDt)">
					 AND B.MODI_DT between  CONCAT(#{startDt}, ' 00:00:00') and  CONCAT(#{endDt}, ' 23:59:59')
				</if>		
					<if test="isNotNull(searchUnm)">
					 AND B.MODI_ID IN (SELECT USER_ID FROM mind_mgr WHERE USER_NM LIKE  CONCAT('%', #{searchUnm},'%')   )
				</if>				
									
				
				ORDER BY A.REG_DT DESC, A.INTAKE_CD DESC, COUNSEL_NO DESC
		<choose>
			<when test="pageCommonFlag == true">
				) A
			</when>
			<otherwise>
				LIMIT #{firstIndex} , #{pageSize}
			</otherwise>
		</choose>
	</select>
	
	<select id="getBbsList4" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
			<if test="pageCommonFlag == true">
			SELECT COUNT(*) pageCommonCount
			  FROM
			    (
		</if>
							select 
					A.INTAKE_CD as intakeCd 
					,B.COUNSEL_NO as counselNo
					,A.COUNSEL_NM as counselNm
					,A.MOBILE as mobile
					,B.DATE as date
					,B.TIME as time
					,B.CAUSE as cause
					,B.STATUS as status
					,B.USER_ID as userId
					,B.REG_DT as regDt
					,B.MODI_DT as modiDt
					,(SELECT USER_NM FROM mind_mgr WHERE USER_ID=B.USER_ID) AS userNm
					,B.MODI_ID as modiId
					, (CASE WHEN SUBSTRING(B.CAUSE,1,1) = '1' THEN '건강한 마음'
							WHEN SUBSTRING(B.CAUSE,1,1) = '2' THEN '성장하는 삶'
							WHEN SUBSTRING(B.CAUSE,1,1) = '3' THEN '행복한 가정'
							WHEN SUBSTRING(B.CAUSE,1,1) = '4' THEN '즐거운 직장'
							WHEN SUBSTRING(B.CAUSE,1,1) = '5' THEN '기타'
							END) AS strCause
					, (CASE 
							WHEN B.STATUS = '' THEN '상담예정'
							WHEN B.STATUS IS NULL THEN '상담예정'
							WHEN B.STATUS = '1' THEN '상담예정'
							WHEN B.STATUS = '2' THEN '상담진행'
							WHEN B.STATUS = '3' THEN '상담종결' END) AS strStatus

					,(SELECT USER_NM FROM mind_mgr WHERE USER_ID=B.MODI_ID) AS modiNm
 					from hue_counsel_intake AS A 
 					left join  hue_counsel_mgr AS B on A.INTAKE_CD=B.INTAKE_CD
				 
				WHERE 1=1
				
								<if test="isNotNull(checkUserId)">
							AND( B.USER_ID=  #{checkUserId} or B.REG_ID=  #{checkUserId} )
				</if>
				<if test="isNotNull(centerNm)">
					AND B.CAUSE LIKE CONCAT('%', #{centerNm},'%') 
				</if>
				<if test="isNotNull(searchNm)">
					AND A.COUNSEL_NM LIKE CONCAT('%', #{searchNm},'%') 
				</if>
				<if test="isNotNull(searchMobile)">
					AND A.MOBILE  LIKE CONCAT('%', #{searchMobile},'%') 
				</if>
				<if test="isNotNull(statusArr)">
					AND B.STATUS =  #{statusArr} 
				</if>
				<if test="isNotNull(userNm)">
					AND B.USER_ID = #{userNm} 
				</if>
				
				<if test="isNotNull(startRDt)">
					AND A.DATE between #{startRDt} and #{endRDt}					
				</if>				
				<if test="isNotNull(startDt)">
					 AND B.MODI_DT between  CONCAT(#{startDt}, ' 00:00:00') and  CONCAT(#{endDt}, ' 23:59:59')
				</if>		
					<if test="isNotNull(searchUnm)">
					 AND B.MODI_ID IN (SELECT USER_ID FROM mind_mgr WHERE USER_NM LIKE  CONCAT('%', #{searchUnm},'%') )
				</if>			
									
				
				ORDER BY A.REG_DT DESC, A.INTAKE_CD DESC, COUNSEL_NO DESC
		<choose>
			<when test="pageCommonFlag == true">
				) A
			</when>			
		</choose>
	</select>
	<select id="getUserNameList" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
		SELECT 
		USER_ID AS  value , USER_NM as title
 		FROM MIND_MGR 
 		WHERE USE_YN = 'Y' AND MGR_FLAG ='C' and USER_TYPE='3001' and MGR_STATUS='Y'
 		<if test="isNotNull(checkUserId)">
					AND USER_ID=  #{checkUserId} 
		</if>
 
	</select>

	<select id="getUserNameList2" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
		select USER_ID as userId from hue_counsel_mgr 
		where INTAKE_CD=#{intakeCd} 
		and USER_ID=#{userNm}
		<if test="isNotNull(counselNo)">
			AND COUNSEL_NO != #{counselNo}
		</if>
		
		
		
		 limit 1
 
	</select>
		
	<select id="getBbsSelectOne2" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
						SELECT  
				 CONTACT_NO AS contactNo
				,COUNSEL_NM AS counNm
				,MOBILE AS mobile
				,GENDER AS gender
				,RRN AS rrn
				,DATE AS date
				,TIME AS time
				,CAUSE AS cause
				,MEMO AS memo
				,REG_DT AS regDt				
				,C_DATE AS cdate
				,C_TIME AS ctime
				,C_STATUS AS cstatus
				,C_MEMO AS cmemo
				 from hue_counsel_contact
				 
				
		WHERE CONTACT_NO = #{dataSeq}
	</select>
	

	
	<select id="getBbsSelectFiles" resultType="com.ezwel.core.support.util.BBSFileData">
		SELECT  FILE_SEQ AS fileSeq
		       ,DATA_SEQ AS dataSeq
		       ,DATA_TYPE AS dataType
		       ,FILE_NM AS fileNm
		       ,FILE_PATH AS filePath
		       ,MEDIA_NM AS mediaNm
		       ,MEDIA_DD AS mediaDd
		       ,MEDIA_SUBJECT AS mediaSubject
		       ,MEDIA_LINK AS mediaLink
		FROM MIND_BBS_FILE
		WHERE 1=1
		<if test="isNotNull(dataSeq)">
			AND DATA_SEQ = #{dataSeq}
		</if>
		ORDER BY FILE_SEQ DESC
	</select>

	<select id="getBbsSelectFiles2" resultType="com.ezwel.core.support.util.BBSFileData">
		SELECT  FILE_SEQ AS fileSeq
		       ,DATA_SEQ AS dataSeq
		       ,DATA_TYPE AS dataType
		       ,FILE_NM AS fileNm
		       ,FILE_PATH AS filePath
		       ,MEDIA_NM AS mediaNm
		       ,MEDIA_DD AS mediaDd
		       ,MEDIA_SUBJECT AS mediaSubject
		       ,MEDIA_LINK AS mediaLink
		FROM HUE_BBS_FILE
		WHERE 1=1
		<if test="isNotNull(dataSeq)">
			AND DATA_SEQ = #{dataSeq}
		</if>
		ORDER BY FILE_SEQ DESC
	</select>
	
	<delete id="fileDelete"	>
		DELETE FROM MIND_BBS_FILE
		<if test="isNotNull(fileSeq)">
		WHERE file_seq = #{fileSeq}
		</if>
		<if test="isNotNull(dataSeq)">
		WHERE data_seq = #{dataSeq}
		</if>
	</delete>


	<insert id="insertFileInfo" parameterType="com.ezwel.core.support.util.BBSFileDto">
		INSERT INTO MIND_BBS_FILE (
			 DATA_SEQ
			,DATA_TYPE
			,FILE_NM
			,FILE_PATH
		) VALUES (
			 #{dataSeq}
			,#{dataType}
			,#{fileNm}
			,#{filePath}
		)
	</insert>
	<insert id="insertFileInfo2" parameterType="com.ezwel.core.support.util.BBSFileDto">
		INSERT INTO HUE_BBS_FILE (
			 DATA_SEQ
			,DATA_TYPE
			,FILE_NM
			,FILE_PATH
		) VALUES (
			 #{dataSeq}
			,#{dataType}
			,#{fileNm}
			,#{filePath}
		)
	</insert>	

	<select id="getPageList" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
		<if test="pageCommonFlag == true">
			SELECT COUNT(*) pageCommonCount
			  FROM
			    (
		</if>
				SELECT DATA_SEQ  as dataSeq,
					   HTML_URL  as htmlUrl,
					   SUBJECT   as subject,
					   MODI_NM   as modiNm,
					   MODI_ID   as modiId,
					   DATE_FORMAT(STR_TO_DATE(MODI_DT, '%Y%m%d%H%i%s'),'%Y-%m-%d %H:%i:%s') AS modiDt,
					   PAGE_KEY  as pageKey
				  FROM MIND_BBS_DATA
				 WHERE BBS_CD = 'page'
				<if test="isNotNull(searchNm)">
					AND SUBJECT LIKE CONCAT('%', #{searchNm},'%')
				</if>
				 ORDER BY DATA_SEQ DESC
		<choose>
			<when test="pageCommonFlag == true">
				) A
			</when>
			<otherwise>
				LIMIT #{firstIndex} , #{pageSize}
			</otherwise>
		</choose>
	</select>



	<select id="getPageDetail" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
		SELECT DATA_SEQ  as dataSeq,
			   HTML_URL  as htmlUrl,
			   SUBJECT   as subject,
			   CONTENT   as content,
			   MODI_ID   as modiId,
			   MODI_DT   as modiDt,
			   PAGE_KEY  as pageKey
		  FROM MIND_BBS_DATA
		 WHERE BBS_CD = 'page'
		   AND DATA_SEQ = #{dataSeq}
	</select>


	<update id="modifyPageDetail">
		UPDATE MIND_BBS_DATA
		   SET CONTENT = #{content},
		       SUBJECT = #{subject},
		       HTML_URL = #{htmlUrl},
		       PAGE_KEY = #{pageKey},
		       MODI_NM  = #{modiNm},
		       MODI_ID  = #{modiId},
		       MODI_DT  = DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
		 WHERE DATA_SEQ = #{dataSeq}
	</update>


	<insert id="addPageDetail">
		INSERT INTO MIND_BBS_DATA (
				BBS_CD,
				SERVICE_TYPE,
				SUBJECT,
				CONTENT,
				REQ_CD1,
				PAGE_KEY,
				HTML_URL,
 				REG_ID,
 				REG_NM,
				REG_DT
		) VALUES (
				#{bbsCd},
				'HOME',
				#{subject},
				#{content},
				#{reqCd1},
				#{pageKey},
				#{htmlUrl},
 				#{regId},
 				#{regNm},
				DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
		)
	</insert>

	<insert id="insertMediaLinks" >
		INSERT INTO MIND_BBS_FILE (
			DATA_SEQ,
			DATA_TYPE,
			MEDIA_NM,
			MEDIA_DD,
			MEDIA_SUBJECT,
			MEDIA_LINK
		) VALUES (
			#{dataSeq},
			100313,
			#{mediaNm},
			#{mediaDd},
			#{mediaSubject},
			#{mediaLink}
		)
	</insert>

	<delete id="deleteMediaLinks">
		DELETE FROM MIND_BBS_FILE
		WHERE  data_seq = #{dataSeq}
		AND	   data_type = 100313
	</delete>

	<select id="getBbsPressList" resultType="com.ezwel.core.support.util.BBSFileData">
		SELECT FILE_SEQ AS fileSeq
			, DATA_SEQ AS dataSeq
			, DATA_TYPE AS dataType
			, MEDIA_NM AS mediaNm
			, MEDIA_DD AS mediaDd
			, MEDIA_SUBJECT AS mediaSubject
			, MEDIA_LINK AS mediaLink
		FROM MIND_BBS_FILE
		WHERE 1=1
		AND DATA_SEQ = #{dataSeq}
		AND DATA_TYPE = 100313
	</select>

	<select id="getInquiryList" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
		<if test="pageCommonFlag == true">
			SELECT COUNT(*) pageCommonCount
			  FROM
			    (
		</if>
				SELECT DATA_SEQ AS dataSeq
					,BBS_CD AS bbsCd
					,CONTENT AS content
					,INTEREST_DIV AS interestDiv
					,INTEREST_DIV_ETC AS interestDivEtc
					,REQ_ETC AS reqEtc
					,REG_COMPANY AS regCompany
					,REG_DEPT AS regDept
					,REG_GRADE AS regGrade
					,REG_NM AS regNm
					,REG_MOBILE AS regMobile
					,REG_EMAIL AS regEmail
					,DATE_FORMAT(STR_TO_DATE(REG_DT, '%Y%m%d%H%i'),'%Y-%m-%d %H:%i') AS regDt
					,DATE_FORMAT(STR_TO_DATE(CONTACT_DT, '%Y%m%d%H%i'),'%Y-%m-%d %H:%i') AS contactDt
				FROM MIND_BBS_DATA
				WHERE 1=1
				<if test="isNotNull(bbsCd)">
					AND BBS_CD = #{bbsCd}
				</if>
				<if test="isNotNull(searchNm)">
					AND REG_COMPANY LIKE CONCAT('%', #{searchNm},'%')
				</if>
				ORDER BY REG_DT DESC
		<choose>
			<when test="pageCommonFlag == true">
				) A
			</when>
			<otherwise>
				LIMIT #{firstIndex} , #{pageSize}
			</otherwise>
		</choose>
	</select>

	<select id="getInquirySelectOne" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
		SELECT A.DATA_SEQ AS dataSeq
			,A.BBS_CD AS bbsCd
			,A.CONTENT AS content
			,A.INTEREST_DIV AS interestDiv
			,A.INTEREST_DIV_ETC AS interestDivEtc
			,A.REQ_ETC AS reqEtc
			,A.REG_COMPANY AS regCompany
			,A.REG_DEPT AS regDept
			,A.REG_GRADE AS regGrade
			,A.REG_NM AS regNm
			,A.REG_MOBILE AS regMobile
			,A.REG_EMAIL AS regEmail
			,A.REQ_ETC AS reqEtc
			,DATE_FORMAT(STR_TO_DATE(A.REG_DT, '%Y%m%d%H%i'),'%Y-%m-%d %H:%i') AS regDt
			,DATE_FORMAT(STR_TO_DATE(A.CONTACT_DT, '%Y%m%d%H%i'),'%Y-%m-%d %H:%i') AS contactDt
			,(SELECT COMM_NM FROM MIND_COMM_CD WHERE HIGH_COMM_CD = 100282 AND COMM_CD = A.REQ_TYPE) AS reqType
			,(SELECT FILE_PATH FROM MIND_BBS_FILE WHERE DATA_SEQ = #{dataSeq} ) AS filePath
			,(SELECT FILE_NM   FROM MIND_BBS_FILE WHERE DATA_SEQ = #{dataSeq} ) AS fileNm
		FROM MIND_BBS_DATA A
		WHERE 1=1
		AND A.DATA_SEQ = #{dataSeq}
	</select>


	<select id="getBbsInfoList" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
		<if test="pageCommonFlag == true">
			SELECT COUNT(*) pageCommonCount
			  FROM
			    (
		</if>
				SELECT A.SERVICE_TYPE AS serviceType
					,A.BBS_CD AS bbsCd
					,A.BBS_TYPE AS bbsType
					,A.BBS_NM AS bbsNm
					,A.COMMENT AS comment
					,A.REPLY_YN AS replyYn
					,A.COMMENT_YN AS commentYn
					,(SELECT OPTION_CD FROM MIND_COMM_CD WHERE COMM_NM = A.SERVICE_TYPE) AS serviceNm
				FROM MIND_BBS_INFO A
				WHERE 1=1
				AND A.BBS_TYPE != '100315'
				<if test="isNotNull(searchNm)">
					AND A.BBS_NM LIKE CONCAT('%', #{searchNm},'%')
				</if>
				<if test="isNotNull(serviceType)">
					AND A.SERVICE_TYPE = #{serviceType}
				</if>
				ORDER BY BBS_CD DESC
		<choose>
			<when test="pageCommonFlag == true">
				) A
			</when>
			<otherwise>
				LIMIT #{firstIndex} , #{pageSize}
			</otherwise>
		</choose>
	</select>

	<select id="getBbsInfoDetail" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
		SELECT A.SERVICE_TYPE AS serviceType
			,A.BBS_CD AS bbsCd
			,A.BBS_TYPE AS bbsType
			,A.BBS_NM AS bbsNm
			,A.COMMENT AS comment
			,A.REPLY_YN AS replyYn
			,A.COMMENT_YN AS commentYn
			,(SELECT COMM_NM FROM MIND_COMM_CD WHERE COMM_CD = A.BBS_TYPE) AS bbsTypeNm
			,(SELECT OPTION_CD FROM MIND_COMM_CD WHERE COMM_NM = A.SERVICE_TYPE) AS serviceNm
		FROM MIND_BBS_INFO A
		WHERE 1=1
		AND A.BBS_CD = #{bbsCd}
		<if test="isNotNull(serviceType)">
			AND SERVICE_TYPE = #{serviceType}
		</if>
	</select>

	<update id="updateBbsInfo">
		UPDATE MIND_BBS_INFO
		   SET BBS_NM = #{bbsNm}
		   	  ,COMMENT = #{comment}
		 WHERE BBS_CD = #{bbsCd}
		 AND   SERVICE_TYPE = #{serviceType}
	</update>

	<insert id="insertBbsInfo">
		INSERT INTO MIND_BBS_INFO (
			SERVICE_TYPE,
			BBS_CD,
			BBS_TYPE,
			BBS_NM,
			COMMENT
		) VALUES (
			#{serviceType},
			#{bbsCd},
			#{bbsType},
			#{bbsNm},
			#{comment}
		)
	</insert>


	<select id="getSeminarList" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
		<if test="pageCommonFlag == true">
			SELECT COUNT(*) pageCommonCount
			  FROM
			    (
		</if>
				SELECT
					A.REG_COMPANY AS regCompany ,
					A.REG_NM AS regNm ,
					A.REG_DEPT AS regDept ,
					A.REG_GRADE AS regGrade ,
					A.REG_TEL_NUM AS regTelNum ,
					A.REG_MOBILE AS regMobile ,
					A.REG_EMAIL AS regEmail ,
					(SELECT COMM_NM FROM MIND_COMM_CD WHERE COMM_CD = A.REQ_TYPE) AS bbsTypeNm	,
					DATE_FORMAT(STR_TO_DATE(A.REG_DT, '%Y%m%d%H%i'),'%Y-%m-%d %H:%i') AS regDt
				FROM MIND_BBS_DATA A
				WHERE A.BBS_CD = #{bbsCd}
				AND A.SERVICE_TYPE = #{serviceType}
				<if test="isNotNull(reqType)">
					AND A.REQ_TYPE = #{reqType}
				</if>
				ORDER BY A.REG_DT DESC
		<choose>
			<when test="pageCommonFlag == true">
				) A
			</when>
			<otherwise>
				LIMIT #{firstIndex} , #{pageSize}
			</otherwise>
		</choose>
	</select>

	<select id="getSeminarExcelDownload" resultType="hashmap" timeout="600">
		SELECT
			REPLACE(@ROWNUM := @ROWNUM + 1, '.', '') AS ROWNUM,
			(SELECT COMM_NM FROM MIND_COMM_CD WHERE COMM_CD = A.REQ_TYPE) AS bbsTypeNm	,
			A.REG_COMPANY AS regCompany ,
			A.REG_NM AS regNm ,
			A.REG_DEPT AS regDept ,
			A.REG_GRADE AS regGrade ,
			A.REG_TEL_NUM AS regTelNum ,
			A.REG_MOBILE AS regMobile ,
			A.REG_EMAIL AS regEmail ,
			DATE_FORMAT(STR_TO_DATE(A.REG_DT, '%Y%m%d%H%i'),'%Y-%m-%d %H:%i') AS regDt
		FROM MIND_BBS_DATA A, (SELECT @ROWNUM := 0) R
		WHERE A.BBS_CD = 'enterSeminar'
		AND A.SERVICE_TYPE = 'HOME'
		<if test="isNotNull(reqType)">
			AND A.REQ_TYPE = #{reqType}
		</if>
		ORDER BY A.REG_DT DESC
	</select>

	<select id="getClientList" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
		SELECT   A.DATA_SEQ AS dataSeq
				,  B.CLIENT_CD AS clientCd
				,  B.CLIENT_NM AS clientNm
		FROM MIND_BBS_CLIENT A RIGHT JOIN MIND_CLIENT B
			ON A.CLIENT_CD = B.CLIENT_CD
			<if test="isNotNull(dataSeq)">
				AND A.DATA_SEQ = #{dataSeq}
			</if>
	</select>
	<select id="getClientList2" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
		SELECT   A.DATA_SEQ AS dataSeq
				,  B.CENTER_SEQ AS clientCd
				,  B.CENTER_NM AS clientNm
		FROM HUE_BBS_CLIENT A RIGHT JOIN HUE_CENTER B
			ON A.CENTER_SEQ = B.CENTER_SEQ
			<if test="isNotNull(dataSeq)">
				AND A.DATA_SEQ = #{dataSeq}
			</if>
	</select>
	<select id="getDataSeq" resultType="String">
		SELECT DATA_SEQ AS dataSeq
		FROM MIND_BBS_DATA
		WHERE 1=1
		<if test="isNotNull(bbsCd)">
	  		AND BBS_CD = #{bbsCd}
	    </if>
	    <if test="isNotNull(serviceType)">
			AND SERVICE_TYPE = #{serviceType}
		</if>
		<if test="isNotNull(reqCd1)">
			AND REQ_CD1 = #{reqCd1 }
		</if>
		<if test="isNotNull(pageKey)">
			AND PAGE_KEY = #{pageKey}
		</if>
	</select>

	<insert id="insertBbsClient">
		INSERT INTO MIND_BBS_CLIENT (
			DATA_SEQ,
			CLIENT_CD
		) VALUES (
			#{dataSeq},
			#{clientCd}
		)
	</insert>
	<insert id="insertBbsClient2">
		INSERT INTO HUE_BBS_CLIENT (
			DATA_SEQ,
			CENTER_SEQ
		) VALUES (
			#{dataSeq},
			#{clientCd}
		)
	</insert>
	
		<insert id="insertBbsClient3">

		INSERT INTO HUE_COUNSEL_INTAKE (
			COUNSEL_NM
			,GENDER
			,RRN
			,MOBILE
			,EMAIL
			,MARRY			
			
		
			,EDUCATION
			,SESSION
			,REG_DT
			,REG_ID
			,MODI_DT
			,MODI_ID
		) VALUES (
			#{counselNm}
			,#{gender}
			,#{rrn}
			,#{mobile}
			,#{email}
			,#{marry}					
			
		
			,#{education}
			,#{session}			
			,now()
			,#{regId}
			,now()
			,#{regId}
		)
		<selectKey resultType="String" keyProperty="intakeCd" order="AFTER" >
        	SELECT LAST_INSERT_ID()
    	</selectKey>
	</insert>	
	
	<insert id="insertBbsClient4">

		INSERT INTO HUE_COUNSEL_FAMILY (
			INTAKE_CD
			,NAME
			,RELATION
			,AGE
			,JOB
			,GRADE			
		) VALUES (
			#{intakeCd}
			,#{fname}
			,#{frelation}
			,#{fage}
			,#{fjob}
			,#{fgrade}			
		)

	</insert>	
	
		<insert id="insertBbsClient5">

		INSERT INTO HUE_COUNSEL_MGR (
			INTAKE_CD
			,USER_ID
			,STATUS
			,INTAKE_NUM
			,REG_DT
			,REG_ID
			,MODI_DT
			,MODI_ID
			,CAUSE
			,MEMO4
			,MEMO5
			,MEMO6
			<if test="isNotNull(date)">
			,DATE
			</if>
			,TIME		
			<if test="isNotNull(file1)">
			,FILE_NM1
			,FILE_PATH1
				</if>
		<if test="isNotNull(file2)">
			,FILE_NM2
			,FILE_PATH2
		</if>
		<if test="isNotNull(file3)">
			,FILE_NM3
			,FILE_PATH3
		</if>
		<if test="isNotNull(file4)">
			,FILE_NM4
			,FILE_PATH4
		</if>
		<if test="isNotNull(file5)">
			,FILE_NM5
			,FILE_PATH5
		</if>
		) VALUES (
			#{intakeCd}
			,#{userNm}
			<if test="isNotNull(userNm)">
			,2
			</if>
			<if test="isNull(userNm)">	 
			,1
			</if>
			,0
			,now()
			,#{regId}
			,now()
			,#{regId}	
			,#{cause}
			,#{memo1}
			,#{memo2}
			,#{memo3}
			<if test="isNotNull(date)">
			,#{date}
			</if>
			,#{time}
			<if test="isNotNull(file1)">	  			    
			,#{file1}
			,#{fileP1}
		</if>
		<if test="isNotNull(file2)">	
			,#{file2}
			,#{fileP2}
		</if>
		<if test="isNotNull(file3)">
			,#{file3}
			,#{fileP3}
		</if>
		<if test="isNotNull(file4)">
			,#{file4}
			,#{fileP4}
		</if>
		<if test="isNotNull(file5)">
			,#{file5}
			,#{fileP5}
		</if>
		)

	</insert>	
	
	

	<delete id="deleteBbsClient">
		DELETE FROM MIND_BBS_CLIENT
		WHERE DATA_SEQ = #{dataSeq }
	</delete>
		<delete id="deleteBbsClient2">
		DELETE FROM HUE_BBS_CLIENT
		WHERE DATA_SEQ = #{dataSeq }
	</delete>

	<update id="updateBbsPublicEpilogue" parameterType="com.ezwel.admin.service.hue.dto.BBSAdd2Dto">
		UPDATE hue_counsel_contact
		SET COUNSEL_NM = #{counNm}
		    <if test="isNotNull(mobile)">
		       ,MOBILE = #{mobile}
		    </if>
		    <if test="isNotNull(genderArr)">
				,GENDER = #{genderArr}
			</if>
			<if test="isNotNull(rrn)">
				,RRN = #{rrn}
			</if>
		    <if test="isNotNull(date)">
				,DATE = #{date}
			</if>

		    <if test="isNotNull(time)">
				,TIME = #{time}
			</if>
		    <if test="isNotNull(statusArr)">
				,CAUSE = #{statusArr}
			</if>
		    <if test="isNotNull(memo)">
				,MEMO = #{memo}
			</if>
		    <if test="isNotNull(cmemo)">
				,C_MEMO = #{cmemo}
			</if>			

  			<if test="isNotNull(cdate)">
				,C_DATE = #{cdate}
			</if>

		    <if test="isNotNull(ctime)">
				,C_TIME = #{ctime}
			</if>
			
												
		    <if test="isNotNull(cstatus)">
				,C_STATUS = #{cstatus}
			</if>
			<if test="isNotNull(modiNm)">
				,ED_ID = #{modiId}
				,ED_DT = NOW()
			</if>
		WHERE CONTACT_NO = #{dataSeq}
	</update>

	<insert id="addBbsPublicReply">
		INSERT INTO MIND_BBS_DATA (
			 BBS_CD
			,HIGH_DATA_SEQ
			,CLIENT_CD
<!-- 			,REPLY_YN -->
			,SERVICE_TYPE
			,CONTENT
			,STATUS
			,REG_ID
			,REG_NM
			,REG_DT
		) VALUES (
			 #{bbsCd}
			,#{highDataSeq}
			,#{clientCd}
<!-- 			,#{replyYn} -->
			,'SANGDAM4U'
			,#{content}
			,#{status}
			,#{regId}
			,#{regNm}
			,DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
		)
	</insert>
	
	<!--  hue -->

	
	<select id="getCounsel" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
						SELECT  
				 	A.INTAKE_CD as intakeCd 
				 	,B.COUNSEL_NO as counselNo
					,B.DATE as date
					,B.TIME as time
					,A.COUNSEL_NM as counselNm
					,A.GENDER as gender
					,A.RRN as rrn
					,A.MOBILE as mobile					
					,A.EMAIL as email
					,A.MARRY as marry
					,A.EDUCATION as education
					,A.SESSION as session
					,B.CAUSE as cause					
					,B.MEMO4 as memo1
					,B.MEMO5 as memo2
					,B.MEMO6 as memo3										
					,B.FILE_NM1 as file1
					,B.FILE_PATH1 as fileP1					
					,B.FILE_NM2 as file2
					,B.FILE_PATH2 as fileP2
					,B.FILE_NM3 as file3
					,B.FILE_PATH3 as fileP3
					,B.FILE_NM4 as file4
					,B.FILE_PATH4 as fileP4					
					,B.FILE_NM5 as file5
					,B.FILE_PATH5 as fileP5																								
					,B.STATUS as status
					,B.USER_ID as userId
					, (CASE 
							WHEN B.STATUS = '' THEN '상담예정'
							WHEN B.STATUS IS NULL THEN '상담예정'
							WHEN B.STATUS = '1' THEN '상담예정'
							WHEN B.STATUS = '2' THEN '상담진행'
							WHEN B.STATUS = '3' THEN '상담종결' END) AS strStatus
					,(SELECT USER_NM FROM mind_mgr WHERE USER_ID=B.USER_ID) AS userNm	
					,(SELECT USER_NM FROM mind_mgr WHERE USER_ID=B.REG_ID) AS regNm
 					from hue_counsel_intake AS A 
 					right join  hue_counsel_mgr AS B on A.INTAKE_CD=B.INTAKE_CD				 				
					WHERE B.COUNSEL_NO = #{dataSeq}
	</select>	
<select id="getFamilyList" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
		SELECT 
		FAMILY_CD as familyCd
		,NAME	as fname		
		,RELATION as frelation
		,AGE as fage
		,JOB as fjob
		,GRADE as fgrade
 		FROM hue_counsel_family 
 		WHERE INTAKE_CD = #{dataSeq}
 
	</select>
	
	<update id="updateBbsClient3">
	
		UPDATE HUE_COUNSEL_INTAKE
		SET  
		
		COUNSEL_NM = #{counselNm}
			,GENDER = #{gender}
			,RRN = #{rrn}
			,MOBILE = #{mobile}
			,EMAIL = #{email}
			,MARRY	 = #{marry}		
			,EDUCATION	 = #{education}
			,SESSION	 = #{session}			
			,MODI_DT	 = now()
			,MODI_ID	 = #{regId}
		WHERE INTAKE_CD = #{intakeCd}

		

	</update>	
	
		<update id="updateBbsClient5">
		UPDATE HUE_COUNSEL_MGR
		SET  
		USER_ID=#{userNm}
		,MODI_DT=now()
		,MODI_ID=#{regId}
		,CAUSE = #{cause}
			,MEMO4 = #{memo1}
			,MEMO5 = #{memo2}
			,MEMO6 = #{memo3}
			,DATE = #{date}
			,TIME	 = #{time}	
		   <if test="isNotNull(file1)">
			,FILE_NM1	 = #{file1}
			,FILE_PATH1	 = #{fileP1}
				</if>
		<if test="isNotNull(file2)">
			,FILE_NM2	 = #{file2}
			,FILE_PATH2	 = #{fileP2}
		</if>
		<if test="isNotNull(file3)">
			,FILE_NM3	 = #{file3}
			,FILE_PATH3	 = #{fileP3}
		</if>
		<if test="isNotNull(file4)">
			,FILE_NM4	 = #{file4}
			,FILE_PATH4	 = #{fileP4}
		</if>
		<if test="isNotNull(file5)">
			,FILE_NM5	 = #{file5}
			,FILE_PATH5	 = #{fileP5}
		</if>
				
			<if test="isNotNull(userNm)">
			,STATUS=2
			</if>
			
		WHERE INTAKE_CD = #{intakeCd}
		AND COUNSEL_NO = #{counselNo}
	

	</update>		
	

	<delete id="deleteBbsClient3">
		DELETE FROM HUE_COUNSEL_FAMILY
		WHERE INTAKE_CD = #{intakeCd }
	</delete>
	
	<select id="getSangdamList" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
		<if test="pageCommonFlag == true">
			SELECT COUNT(*) pageCommonCount
			  FROM
			    (
		</if>
			select 
					A.INTAKE_CD as intakeCd 
					,B.COUNSEL_NO as counselNo
					,A.COUNSEL_NM as counselNm
					,A.MOBILE as mobile
					,B.CAUSE as cause
					,B.STATUS as status
					,B.USER_ID as userId
					,B.REG_DT as regDt
					,B.MODI_DT as modiDt
					,(SELECT USER_NM FROM mind_mgr WHERE USER_ID=B.USER_ID) AS userNm
					, (CASE WHEN B.R_STATUS = '1' THEN '진행'
							WHEN B.R_STATUS = '2' THEN 'N/S'
							WHEN B.R_STATUS = '3' THEN '종결'
							WHEN B.R_STATUS = '4' THEN '미등록'
							END) AS rstatus
					,(SELECT DATE from hue_counsel_record where COUNSEL_NO=B.COUNSEL_NO order by COUNSEL_CD desc limit 1) AS date
					,(SELECT TIME from hue_counsel_record where COUNSEL_NO=B.COUNSEL_NO order by COUNSEL_CD desc limit 1) AS time1
					,(SELECT TIME2 from hue_counsel_record where COUNSEL_NO=B.COUNSEL_NO order by COUNSEL_CD desc limit 1) AS time2
					,B.INTAKE_NUM as intakeNum
					,B.MODI_ID as modiId
					, (CASE WHEN SUBSTRING(B.CAUSE,1,1) = '1' THEN '건강한 마음'
							WHEN SUBSTRING(B.CAUSE,1,1) = '2' THEN '성장하는 삶'
							WHEN SUBSTRING(B.CAUSE,1,1) = '3' THEN '행복한 가정'
							WHEN SUBSTRING(B.CAUSE,1,1) = '4' THEN '즐거운 직장'
							WHEN SUBSTRING(B.CAUSE,1,1) = '5' THEN '기타'
							END) AS strCause
					, (CASE 
							WHEN B.STATUS = '' THEN '상담예정'
							WHEN B.STATUS IS NULL THEN '상담예정'
							WHEN B.STATUS = '1' THEN '상담예정'
							WHEN B.STATUS = '2' THEN '상담진행'
							WHEN B.STATUS = '3' THEN '상담종결' END) AS strStatus

					,(SELECT USER_NM FROM mind_mgr WHERE USER_ID=B.MODI_ID) AS modiNm
					,A.REG_DT
					 ,A.INTAKE_CD
					 ,COUNSEL_NO
 					from hue_counsel_intake AS A 
 					left join  hue_counsel_mgr AS B on A.INTAKE_CD=B.INTAKE_CD
				 

				 	
				WHERE 1=1
				AND B.USER_ID !=''
				<if test="isNotNull(checkUserId)">
					AND B.USER_ID=  #{checkUserId} 
				</if>
				
				<if test="isNotNull(centerNm)">
					AND B.CAUSE LIKE CONCAT('%', #{centerNm},'%') 
				</if>
				<if test="isNotNull(searchNm)">
					AND A.COUNSEL_NM LIKE CONCAT('%', #{searchNm},'%') 
				</if>

				<if test="isNotNull(searchArr)">
					<!-- AND R_STATUS IN ( #{searchArr} ) -->
					AND	 R_STATUS REGEXP #{searchArr}
				</if>
				<if test="isNotNull(userNm)">
					AND B.USER_ID = #{userNm} 
				</if>								
				<if test="isNotNull(searchCnt)">
					AND B.INTAKE_NUM = #{searchCnt} 
				</if>				
				
				<if test="isNotNull(startDt)">
					 AND B.MODI_DT between  CONCAT(#{startDt}, ' 00:00:00') and  CONCAT(#{endDt}, ' 23:59:59')
				</if>		
									
				
				ORDER BY A.REG_DT DESC, A.INTAKE_CD DESC, COUNSEL_NO DESC
												
		<choose>
			<when test="pageCommonFlag == true">
				) A
			</when>
			<otherwise>
				LIMIT #{firstIndex} , #{pageSize}
			</otherwise>
		</choose>
	</select>
<select id="getSangdamList2" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
		<if test="pageCommonFlag == true">
			SELECT COUNT(*) pageCommonCount
			  FROM
			    (
		</if>
			select 
					A.INTAKE_CD as intakeCd 
					,B.COUNSEL_NO as counselNo
					,A.COUNSEL_NM as counselNm
					,A.MOBILE as mobile
					,B.CAUSE as cause
					,B.STATUS as status
					,B.USER_ID as userId
					,B.REG_DT as regDt
					,B.MODI_DT as modiDt
					,(SELECT USER_NM FROM mind_mgr WHERE USER_ID=B.USER_ID) AS userNm
					, (CASE WHEN B.R_STATUS = '1' THEN '진행'
							WHEN B.R_STATUS = '2' THEN 'N/S'
							WHEN B.R_STATUS = '3' THEN '종결'
							WHEN B.R_STATUS = '4' THEN '미등록'
							END) AS rstatus
					,(SELECT DATE from hue_counsel_record where COUNSEL_NO=B.COUNSEL_NO order by COUNSEL_CD desc limit 1) AS date
					,(SELECT TIME from hue_counsel_record where COUNSEL_NO=B.COUNSEL_NO order by COUNSEL_CD desc limit 1) AS time1
					,(SELECT TIME2 from hue_counsel_record where COUNSEL_NO=B.COUNSEL_NO order by COUNSEL_CD desc limit 1) AS time2
					,B.INTAKE_NUM as intakeNum
					,B.MODI_ID as modiId
					, (CASE WHEN SUBSTRING(B.CAUSE,1,1) = '1' THEN '건강한 마음'
							WHEN SUBSTRING(B.CAUSE,1,1) = '2' THEN '성장하는 삶'
							WHEN SUBSTRING(B.CAUSE,1,1) = '3' THEN '행복한 가정'
							WHEN SUBSTRING(B.CAUSE,1,1) = '4' THEN '즐거운 직장'
							WHEN SUBSTRING(B.CAUSE,1,1) = '5' THEN '기타'
							END) AS strCause
					, (CASE 
							WHEN B.STATUS = '' THEN '상담예정'
							WHEN B.STATUS IS NULL THEN '상담예정'
							WHEN B.STATUS = '1' THEN '상담예정'
							WHEN B.STATUS = '2' THEN '상담진행'
							WHEN B.STATUS = '3' THEN '상담종결' END) AS strStatus

					,(SELECT USER_NM FROM mind_mgr WHERE USER_ID=B.MODI_ID) AS modiNm
					,A.REG_DT
					 ,A.INTAKE_CD
					 ,COUNSEL_NO
 					from hue_counsel_intake AS A 
 					left join  hue_counsel_mgr AS B on A.INTAKE_CD=B.INTAKE_CD
				 

				 	
				WHERE 1=1
				AND B.USER_ID !=''
				<if test="isNotNull(checkUserId)">
					AND B.USER_ID=  #{checkUserId} 
				</if>
				
				<if test="isNotNull(centerNm)">
					AND B.CAUSE LIKE CONCAT('%', #{centerNm},'%') 
				</if>
				<if test="isNotNull(searchNm)">
					AND A.COUNSEL_NM LIKE CONCAT('%', #{searchNm},'%') 
				</if>

				<if test="isNotNull(searchArr)">
					<!-- AND R_STATUS IN ( #{searchArr} ) -->
					AND	 R_STATUS REGEXP #{searchArr}
				</if>
				<if test="isNotNull(userNm)">
					AND B.USER_ID = #{userNm} 
				</if>								
				<if test="isNotNull(searchCnt)">
					AND B.INTAKE_NUM = #{searchCnt} 
				</if>				
				
				<if test="isNotNull(startDt)">
					 AND B.MODI_DT between  CONCAT(#{startDt}, ' 00:00:00') and  CONCAT(#{endDt}, ' 23:59:59')
				</if>		
									
				
				ORDER BY A.REG_DT DESC, A.INTAKE_CD DESC, COUNSEL_NO DESC
												
		<choose>
			<when test="pageCommonFlag == true">
				) A
			</when>
		</choose>
	</select>	
	<select id="getIntake" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
						SELECT  
				 	A.INTAKE_CD as intakeCd 
				 	,B.COUNSEL_NO as counselNo
					,B.DATE as date
					,B.TIME as time
					,A.COUNSEL_NM as counselNm
					,A.GENDER as gender
					,A.RRN as rrn
					,A.MOBILE as mobile					
					,A.EMAIL as email
					,A.MARRY as marry
					,A.EDUCATION as education
					,A.SESSION as session
					,B.CAUSE as cause					
					,B.MEMO1 as memo1
					,B.MEMO2 as memo2
					,B.MEMO3 as memo3																																						
					,B.STATUS as status
					,B.USER_ID as userId
					,B.TYPE as type
					,B.ETC as etc
					,B.INTAKE_NUM as intakeNum
					, (CASE WHEN SUBSTRING(B.CAUSE,1,1) = '1' THEN '건강한 마음/'
							WHEN SUBSTRING(B.CAUSE,1,1) = '2' THEN '성장하는 삶/'
							WHEN SUBSTRING(B.CAUSE,1,1) = '3' THEN '행복한 가정/'
							WHEN SUBSTRING(B.CAUSE,1,1) = '4' THEN '즐거운 직장/'
							WHEN SUBSTRING(B.CAUSE,1,1) = '5' THEN '기타'
							END) AS strCause
					, (CASE WHEN SUBSTRING(B.CAUSE,3,1) = '1' THEN '건강한 마음/'
							WHEN SUBSTRING(B.CAUSE,3,1) = '2' THEN '성장하는 삶/'
							WHEN SUBSTRING(B.CAUSE,3,1) = '3' THEN '행복한 가정/'
							WHEN SUBSTRING(B.CAUSE,3,1) = '4' THEN '즐거운 직장/'
							WHEN SUBSTRING(B.CAUSE,3,1) = '5' THEN '기타'							
							END) AS strCause1
							
					, (CASE WHEN SUBSTRING(B.CAUSE,5,1) = '1' THEN '건강한 마음/'
							WHEN SUBSTRING(B.CAUSE,5,1) = '2' THEN '성장하는 삶/'
							WHEN SUBSTRING(B.CAUSE,5,1) = '3' THEN '행복한 가정/'
							WHEN SUBSTRING(B.CAUSE,5,1) = '4' THEN '즐거운 직장/'
							WHEN SUBSTRING(B.CAUSE,5,1) = '5' THEN '기타'
							END) AS strCause2
							
					, (CASE WHEN SUBSTRING(B.CAUSE,7,1) = '1' THEN '건강한 마음/'
							WHEN SUBSTRING(B.CAUSE,7,1) = '2' THEN '성장하는 삶/'
							WHEN SUBSTRING(B.CAUSE,7,1) = '3' THEN '행복한 가정/'
							WHEN SUBSTRING(B.CAUSE,7,1) = '4' THEN '즐거운 직장/'
							WHEN SUBSTRING(B.CAUSE,7,1) = '5' THEN '기타'							
							END) AS strCause3	
					,(SELECT USER_NM FROM mind_mgr WHERE USER_ID=B.USER_ID) AS userNm	
					,(SELECT USER_NM FROM mind_mgr WHERE USER_ID=B.REG_ID) AS regNm
 					from hue_counsel_intake AS A 
 					right join  hue_counsel_mgr AS B on A.INTAKE_CD=B.INTAKE_CD				 				
					WHERE B.COUNSEL_NO = #{dataSeq}
	</select>	
		<select id="getMgr" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
	
	</select>	
		<select id="getRecord" resultType="com.ezwel.admin.domain.entity.bbs.BBSData">
					select 
					RECORD_CD as recordCd
					,COUNSEL_NO as counselNo
					,COUNSEL_CD as counselCd
					,DATE as date
					,TIME as time1
					,TIME2 as time2
					,SUBJECT as subject
					,MAIN_ISSUE as mainIssue
					,GOAL as goal
					,INTERVENTION as intervention
					,FEEDBACK as feedback
					,MEMO1 as rmemo1
					,MEMO2 as rmemo2
					,MEMO3 as rmemo3
					,MEMO4 as rmemo4
					,MEMO5 as rmemo5
					,MEMO6 as rmemo6
					,MEMO7 as rmemo7
					,FILE_NM1 as fileNm1
					,FILE_PATH1 as filePath1
					,FILE_NM2 as fileNm2
					,FILE_PATH2 as filePath2					
					,RISKS as risks
					,RISK_REASON as riskReason
					,ISSUE as issue
					,CALLING_ISSUE as callingIssue
					,STATUS as status
					,NEXT_DT as nextDt
					,NEXT_TIME as nextTime
					,REG_DT as regDt
					,MODI_DT as modiDt
					,NEXT_FLAG as nextFlag
					,NEXT_STR as nextStr

					FROM hue_counsel_record
					where COUNSEL_NO=#{dataSeq} 
					and
					COUNSEL_CD=#{pageNum}		 				
					
	</select>		
	
	<insert id="insertRecord" keyProperty="dataSeq" useGeneratedKeys="true" parameterType="com.ezwel.admin.service.hue.dto.BBSAdd2Dto">
		INSERT INTO hue_counsel_record (
			 COUNSEL_NO
			,COUNSEL_CD
			<if test="isNotNull(date)">
			,DATE
			,TIME
			,TIME2			
			</if>
			,SUBJECT
			,MAIN_ISSUE
			,GOAL
			,INTERVENTION
			,FEEDBACK			
			,MEMO1
			,MEMO2
			,MEMO3
			,MEMO4
			,MEMO5
			,MEMO6
			,MEMO7			
			,FILE_NM1
			,FILE_PATH1
			,FILE_NM2
			,FILE_PATH2
			,RISKS			
			,RISK_REASON
			,ISSUE
			,CALLING_ISSUE
			,STATUS
			<if test="isNotNull(nextDt)">
			,NEXT_DT			
			,NEXT_TIME
			</if>
			,NEXT_FLAG
			,NEXT_STR
			,REG_DT
			,REG_ID
			,MODI_DT
			,MODI_ID			
		) VALUES (
			 #{counselNo}			
			,#{pageNum2}
			<if test="isNotNull(date)">
			,#{date}
			,#{time1}
			,#{time2}			
			</if>
			,#{subject}
			,#{mainIssue}
			,#{goal}
			,#{intervention}
			,#{feedback}			
			,#{rmemo1}
			,#{rmemo2}
			,#{rmemo3}
			,#{rmemo4}
			,#{rmemo5}
			,#{rmemo6}
			,#{rmemo7}			
			,#{fileNm1}
			,#{filePath1}
			,#{fileNm2}
			,#{filePath2}
			,#{risks}			
			,#{riskReason}
			,#{issue}
			,#{callingIssue}
			,#{status}
			<if test="isNotNull(nextDt)">
			,#{nextDt}
			,#{nextTime}			
			</if>
			,#{nextFlag}
			,#{nextStr}
			,now()
			,#{regId}
			,now()
			,#{regId}
		)
	</insert>
	
	<update id="updateRecord" parameterType="com.ezwel.admin.service.hue.dto.BBSAdd2Dto">
		UPDATE hue_counsel_record
		SET  
			SUBJECT=#{subject}
			<if test="isNotNull(date)">
			,DATE=#{date}
			,TIME=#{time1}
			,TIME2=#{time2}			
			</if>			
			,MAIN_ISSUE=#{mainIssue}
			,GOAL=#{goal}
			,INTERVENTION=#{intervention}
			,FEEDBACK	=#{feedback}		
			,MEMO1=#{rmemo1}
			,MEMO2=#{rmemo2}
			,MEMO3=#{rmemo3}
			,MEMO4=#{rmemo4}
			,MEMO5=#{rmemo5}
			,MEMO6=#{rmemo6}
			,MEMO7	=#{rmemo7}
			,NEXT_FLAG=#{nextFlag}
			,NEXT_STR=#{nextStr}
			<if test="isNotNull(fileNm1)">	
			,FILE_NM1=#{fileNm1}			
			,FILE_PATH1=#{filePath1}
			</if>
			<if test="isNotNull(fileNm2)">
			,FILE_NM2=#{fileNm2}
			,FILE_PATH2=#{filePath2}
			</if>
			,RISKS=#{risks}			
			,RISK_REASON=#{riskReason}
			,ISSUE=#{issue}
			,CALLING_ISSUE=#{callingIssue}
			,STATUS=#{status}
			<if test="isNotNull(nextDt)">
			,NEXT_DT=#{nextDt}			
			,NEXT_TIME=#{nextTime}
			</if>			
			,MODI_DT=now()			
			,MODI_ID=#{regId}					    
		WHERE  RECORD_CD =#{recordCd}
	</update>
	
	<update id="updateMgr" parameterType="com.ezwel.admin.service.hue.dto.BBSAdd2Dto">
		UPDATE hue_counsel_mgr
		SET  MEMO1 = #{memo1}
		    ,MEMO2 = #{memo2}
			,MEMO3 = #{memo3}
			,TYPE = #{type}
			,ETC = #{etc}
			
		    <if test="isNotNull(mgrStatus)">
				,STATUS = #{mgrStatus}
			</if>
			<if test="isNotNull(rstatus)">
				,R_STATUS = #{rstatus}
			</if>
			<if test="isNotNull(pageNum2)">
				,INTAKE_NUM = #{pageNum2}
			</if>
						
				,MODI_DT = now()			
				,MODI_ID = #{regId}
			
		WHERE  COUNSEL_NO =#{counselNo}
	</update>
</mapper>